/*!
 * jQuery Uploader
 * Copyright (c) 2013 CreativeDream
 * Version: 1.0 (30-03-2013)
 * Requires: jQuery v1.7.1 or later 
*/
(function(e){e.fn.uploader=function(t){var n=$.extend(e.fn.uploader.defaults,t);return this.each(function(t,r){var s=e(this),m=true,f={init:function(){f._bindOptions()},_bindOptions:function(){s.submit(f._submit)},_enable:function(){m=true},_disable:function(){m=false},_destroy:function(){m="destroy"},_submit:function(e){if(m=="destroy"){return true}if(f.hasAttr("data-uploader")&&s.attr("data-uploader")=="off"){return true}e.preventDefault();if(!m){return false}if(f.hasAttr("data-uploader")&&s.attr("data-uploader")=="disabled"){return false}if(n.beforeSend!=null&&typeof n.beforeSend=="function"?!n.beforeSend(s):false){return false}if(f.hasAttr("data-uploader-beforeSend")){var form=s;eval(s.attr("data-uploader-beforeSend"))}if(f.hasAttr("data-validate")&&s.attr("data-validate")=="false"){return false}var url=n.url!=null?n.url:s.attr("action"),type=n.type!=null?n.type:s.attr("method"),formData=new FormData(s[0]),submitBtn=n.submitB?true:false;if(n.data!=null){for(k in n.data){formData.append(k,n.data[k])}}if(submitBtn){var _sBls=s.find(":submit");f._sBlsV=_sBls.val();_sBls.addClass("disabled").attr("disabled","disabled").val("Loading...")}if(n.progress){f._progressShow()}$.ajax({url:url,data:formData,type:type,enctype:n.enctype,xhr:function(){myXhr=$.ajaxSettings.xhr();if(myXhr.upload){myXhr.upload.addEventListener("progress",f._progressHandling,false)}return myXhr},success:function(data,textStatus,jqXHR){f._progressHide();if(submitBtn){_sBls.removeClass("disabled").removeAttr("disabled","disabled").val(f._sBlsV)}if(f.hasAttr("data-uploader-success")){var form=s;eval(s.attr("data-uploader-success"))}n.success!=null&&typeof n.success=="function"?n.success(data,s,textStatus,jqXHR):null},error:function(jqXHR,textStatus,errorThrown){f._progressHide();if(submitBtn){_sBls.removeClass("disabled").removeAttr("disabled","disabled").val(f._sBlsV)}if(f.hasAttr("data-uploader-error")){var form=s;eval(s.attr("data-uploader-error"))}n.error!=null&&typeof n.error=="function"?n.error(s,jqXHR,textStatus,errorThrown):null},statusCode:n.statusCode,cache:n.cache,contentType:n.contentType,processData:n.processData});n.onSend!=null&&typeof n.onSend=="function"?n.onSend(s):null;if(f.hasAttr("data-uploader-onSend")){var form=s;eval(s.attr("data-uploader-onSend"))}return false},_progressHandling:function(e){if(e.lengthComputable){var t=Math.round(e.loaded*100/e.total).toString();n.onProgress!=null&&typeof n.onProgress=="function"?n.onProgress(t,f._prBd,s):null;if(n.progress){f._prBd.css("width",t+"%")}}},_progressShow:function(){$(".uploader-progressbar").remove();f._prBd=e(n.progressHTML);f._prBd.appendTo(n.appendProgressTo)},_progressHide:function(){if(!f._prBd){return}f._prBd.fadeOut(250,function(){$(this).remove()})},hasAttr:function(e){e=s.attr(e);return typeof e!==typeof undefined&&e!==false}};f.init();s.on("uploader.submit",f._submit);s.on("uploader.enable",f._enable);s.on("uploader.disable",f._disable);s.on("uploader.destroy",f._destroy);return this})};e.fn.uploader.defaults={url:null,data:null,type:"POST",enctype:"multipart/form-data",cache:false,contentType:false,processData:false,statusCode:{},progress:false,progressHTML:'<div class="uploader-progressbar"></div>',appendProgressTo:"body",submitB:true,beforeSend:null,onSend:null,onProgress:null,success:null,error:null}})(jQuery);
